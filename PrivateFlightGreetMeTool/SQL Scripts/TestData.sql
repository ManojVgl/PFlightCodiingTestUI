/* Delete existing data from table*/
Delete from  [PRIVATEFLIGHT].[GREETINGTEXT]
Go
/*Insert test data*/

 INSERT INTO [PRIVATEFLIGHT].[GREETINGTEXT] (
    	COUNTRYCODE,	TITLE,	MESSAGETEXT,	STARTDATE,	ENDDATE,	IsActive,	MESSAGETYPE
 )
 VALUES
	('NZT','Manoj','Kia Ora','9999-12-31 01:00:00.0000000 +00:00','9999-12-30 01:00:00.0000000 +00:00',1,'A'),
	('NZT','Manoj','Kia Ora koutou','0001-01-01 00:54:00.0000000 +00:00','9999-12-31 01:00:00.0000000 +00:00',1,'A'),
	('IND','Manoj','Namaste','2023-05-12 00:24:00.0000000 +00:00','9999-12-31 01:00:00.0000000 +00:00',1,'A'),
	('IND','Manoj','Happy Onam','2023-09-02 00:25:00.0000000 +00:00','2023-10-01 00:25:00.0000000 +00:00',1,'B'),
	('IND','Manoj','Happy Onam to all of you','2023-09-07 00:25:00.0000000 +00:00','2023-10-27 00:26:00.0000000 +00:00',1,'B'),
	('AAA','Manoj','Hello World','2023-05-12 00:26:00.0000000 +00:00','9999-12-31 01:00:00.0000000 +00:00',1,'A'),
	('AFG','Manoj','Happy Eid','2023-05-12 00:27:00.0000000 +00:00','2023-05-20 00:28:00.0000000 +00:00',1,'B'),
	('AFG','Manoj','Eid Mubarak','2023-05-20 00:28:00.0000000 +00:00','2023-05-20 00:28:00.0000000 +00:00',1,'B'),
	('USA','Manoj','Hello Welcome Miami','2023-05-12 00:29:00.0000000 +00:00','2023-05-13 00:29:00.0000000 +00:00',1,'B')


Go
/*

TEST SCRIPTS

*/

  -- update [db_a53e39_boutique].[PRIVATEFLIGHT].[GREETINGTEXT] set enddate='2023-05-20 00:28:00.0000000 +00:00',messagetype='B' where id=7
  -- update [db_a53e39_boutique].[PRIVATEFLIGHT].[GREETINGTEXT] set startdate='9999-12-31 01:00:00.0000000 +00:00' where id=1

--scenario 1

exec [PRIVATEFLIGHT].[usp_GREETINGTEXTSelectGreeting] 'NZT','9999-12-31 01:00:00.0000000 +00:00'


    /*SELECT 
            
        [MESSAGETEXT]  

        FROM [PRIVATEFLIGHT].[GREETINGTEXT]  
        WHERE [ISACTIVE]=1 AND  [COUNTRYCODE]='NZT' AND [ENDDATE]<='9999-12-31 01:00:00.0000000 +00:00' AND [MESSAGETYPE]='A'
        ORDER BY STARTDATE ASC*/

--scenario B

exec [PRIVATEFLIGHT].[usp_GREETINGTEXTSelectGreeting] 'IND','2023-10-01 00:25:00.0000000 +00:00'

SELECT COUNT(ID) FROM [PRIVATEFLIGHT].[GREETINGTEXT]  WHERE [ISACTIVE]=1 AND 
 [COUNTRYCODE]='IND' AND [ENDDATE]<='2023-10-27 00:26:00.0000000 +00:00' AND [MESSAGETYPE]='B'

  SELECT 
           
        [MESSAGETEXT]    
        FROM [PRIVATEFLIGHT].[GREETINGTEXT]
        WHERE [ISACTIVE]=1 AND  [COUNTRYCODE]='IND' AND '2023-10-01 00:25:00.0000000 +00:00'>=[STARTDATE] AND [MESSAGETYPE]='B'
        ORDER BY STARTDATE DESC
--scenario c

exec [PRIVATEFLIGHT].[usp_GREETINGTEXTSelectGreeting] 'AFG','2023-05-25 00:28:00.0000000 +00:00'

SELECT COUNT(ID) FROM [PRIVATEFLIGHT].[GREETINGTEXT]  WHERE [ISACTIVE]=1 AND 
 [COUNTRYCODE]='AFG' 
 AND [STARTDATE]>='2023-05-25 00:28:00.0000000 +00:00'
 AND [ENDDATE]<='2023-05-25 00:28:00.0000000 +00:00'   
 AND [MESSAGETYPE]='B'